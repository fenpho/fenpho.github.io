<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
Theme By Fenpho
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>Kudzu-UI | Fenpho</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Fenpho">
    <meta name="author" content="Fenpho">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Fenpho" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">首页</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">归档</a></li>
            <!-- Dropdown Menu -->
			 
            
        	<li>
        		<a class="sb-toggle-submenu">分类<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/前端漫谈/" class="animsition-link">前端漫谈<small>(22)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">友情链接<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://fenpho.github.io/" class="animsition-link">Fenpho</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about" class="animsition-link" title="about">关于</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">订阅</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Fenpho</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/fenpho" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">更多</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2022-12-23T12:16:09.000Z" itemprop="datePublished">
          2022-12-23
      </time>
    
    
    | 
    <a href='/tags/kudzu-typescript，vue-组件库/'>kudzu, typescript，vue, 组件库</a>
    
    
</span>
                <h1>Kudzu-UI</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<blockquote>
<p>兼容性注意<br>Vite 需要 Node.js 版本 14.18+，16+。然而，有些模板需要依赖更高的 Node 版本才能正常运行，当你的包管理器发出警告时，请注意升级你的 Node 版本。</p>
</blockquote>
<p>手把手教你从零到开始打造一个属于自己的vue3UI组件库。技术栈：Vite + Vue3 + Typescript + Less。</p>
<h3 id="一、使用-Vite-初始化项目"><a href="#一、使用-Vite-初始化项目" class="headerlink" title="一、使用 Vite 初始化项目"></a>一、使用 Vite 初始化项目</h3><p>在空白目录执行下列命令：</p>
<ol>
<li><p>在终端输入命令yarn create vite，运行后出现如下界面<br><img src="1.png"></p>
</li>
<li><p>输入项目名称进行，然后回车<br><img src="2.png"></p>
</li>
<li><p>按键盘上下键切换，回车确认，这里我们选择vue<br><img src="3.png"></p>
</li>
<li><p>选择TypeScript<br><img src="4.png"></p>
</li>
<li><p>安装依赖yarn create vite<br><img src="5.png"></p>
</li>
<li><p>跑起来看下yarn dev<br><img src="6.png"></p>
</li>
<li><p>效果如下图所示：<br><img src="7.png"></p>
</li>
</ol>
<h3 id="二、项目改造"><a href="#二、项目改造" class="headerlink" title="二、项目改造"></a>二、项目改造</h3><h4 id="1-添加jsx支持"><a href="#1-添加jsx支持" class="headerlink" title="1. 添加jsx支持"></a>1. 添加jsx支持</h4><p>安装插件：<br><code>yarn add @vitejs/plugin-vue-jsx</code></p>
<p>配置插件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vueJsx(&#123;</span><br><span class="line">      <span class="comment">// options are passed on to @vue/babel-plugin-jsx</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-添加less支持"><a href="#2-添加less支持" class="headerlink" title="2. 添加less支持"></a>2. 添加less支持</h4><p>安装插件：<br><code>npm add -D less</code></p>
<ol start="3">
<li>目录及文件改造的tsx和less改造<br>改造前目录结构<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">│  .gitignore</span><br><span class="line">│  index.html</span><br><span class="line">│  package.json</span><br><span class="line">│  README.md</span><br><span class="line">│  tsconfig.json</span><br><span class="line">│  tsconfig.node.json</span><br><span class="line">│  vite.config.ts</span><br><span class="line">│  yarn-error.log</span><br><span class="line">│  yarn.lock</span><br><span class="line">│       </span><br><span class="line">├─public</span><br><span class="line">│      vite.svg</span><br><span class="line">│      </span><br><span class="line">└─src</span><br><span class="line">    │  App.vue</span><br><span class="line">    │  main.ts</span><br><span class="line">    │  style.css</span><br><span class="line">    │  vite-env.d.ts</span><br><span class="line">    │  </span><br><span class="line">    ├─assets</span><br><span class="line">    │      vue.svg</span><br><span class="line">    │      </span><br><span class="line">    └─components</span><br><span class="line">            HelloWorld.vue</span><br></pre></td></tr></table></figure></li>
</ol>
<p>将App.vue文件改为App.tsx</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueLogo <span class="keyword">from</span> <span class="string">&#x27;./assets/vue.svg&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./App.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;div id=<span class="string">&quot;App&quot;</span> <span class="class"><span class="keyword">class</span></span>=&#123;styles.App&#125;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;https://vitejs.dev&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;</span><br><span class="line">            &lt;img src=<span class="string">&quot;/vite.svg&quot;</span> <span class="class"><span class="keyword">class</span></span>=&#123;styles.logo&#125; alt=<span class="string">&quot;Vite logo&quot;</span> /&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;https://vuejs.org/&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;</span><br><span class="line">            &lt;img src=&#123;vueLogo&#125; <span class="class"><span class="keyword">class</span></span>=&#123;<span class="string">`<span class="subst">$&#123;styles.logo&#125;</span> <span class="subst">$&#123;styles.vue&#125;</span>`</span>&#125; alt=<span class="string">&quot;Vue logo&quot;</span> /&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        Kudzu UI</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>新增文件App.modules.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.App</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">6em</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1.5em</span>;</span><br><span class="line">    will-change: <span class="attribute">filter;</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">    &amp;</span>:hover &#123;</span><br><span class="line">      <span class="attribute">filter</span>: drop-shadow(<span class="number">0</span> <span class="number">0</span> <span class="number">2em</span> <span class="number">#646cff</span>aa);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.vue</span> &#123;</span><br><span class="line">    <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">filter</span>: drop-shadow(<span class="number">0</span> <span class="number">0</span> <span class="number">2em</span> <span class="number">#42b883</span>aa);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将style.css改为style.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Inter, Avenir, Helvetica, Arial, sans-serif;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">color-scheme</span>: light dark;</span><br><span class="line">  <span class="attribute">color</span>: rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.87</span>);</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#242424</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">font-synthesis</span>: none;</span><br><span class="line">  <span class="attribute">text-rendering</span>: optimizeLegibility;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">  -webkit-text-size-adjust: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#646cff</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: inherit;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#535bf2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  place-items: center;</span><br><span class="line">  <span class="attribute">min-width</span>: <span class="number">320px</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">3.2em</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.6em</span> <span class="number">1.2em</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: inherit;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#1a1a1a</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">transition</span>: border-color <span class="number">0.25s</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">border-color</span>: <span class="number">#646cff</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:focus</span>,</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:focus</span><span class="selector-tag">-visible</span> &#123;</span><br><span class="line">      <span class="attribute">outline</span>: <span class="number">4px</span> auto -webkit-focus-ring-color;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2em</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#app</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1280px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>: light) &#123;</span><br><span class="line">  <span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#213547</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="selector-tag">a</span> &#123;</span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#747bff</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">button</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#f9f9f9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改造后目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">│  .gitignore</span><br><span class="line">│  index.html</span><br><span class="line">│  package.json</span><br><span class="line">│  README.md</span><br><span class="line">│  tsconfig.json</span><br><span class="line">│  tsconfig.node.json</span><br><span class="line">│  vite.config.ts</span><br><span class="line">│  yarn-error.log</span><br><span class="line">│  yarn.lock</span><br><span class="line">│       </span><br><span class="line">├─public</span><br><span class="line">│      vite.svg</span><br><span class="line">│      </span><br><span class="line">└─src</span><br><span class="line">    │  App.tsx</span><br><span class="line">    │  App.modeles.less</span><br><span class="line">    │  main.ts</span><br><span class="line">    │  style.less</span><br><span class="line">    │  vite-env.d.ts</span><br><span class="line">    │  </span><br><span class="line">    ├─assets</span><br><span class="line">    │      vue.svg</span><br><span class="line">    │      </span><br><span class="line">    └─components</span><br></pre></td></tr></table></figure>
<h4 id="4-自适应布局"><a href="#4-自适应布局" class="headerlink" title="4. 自适应布局"></a>4. 自适应布局</h4><p>添加插件：postcss-px-to-viewport<br>将px单位转换为视口单位的 (vw, vh, vmin, vmax) 的 PostCSS 插件<br><code>yarn add -D postcss-px-to-viewport</code><br>使用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pxtoviewport <span class="keyword">from</span> <span class="string">&#x27;postcss-px-to-viewport&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pxtoviewportConfig = pxtoviewport(&#123;</span><br><span class="line">  viewportWidth: <span class="number">1366</span>, <span class="comment">// 设计稿的视口宽度</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">    vueJsx(&#123;</span><br><span class="line">      <span class="comment">// options are passed on to @vue/babel-plugin-jsx</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  css: &#123;</span><br><span class="line">    postcss: &#123;</span><br><span class="line">      plugins: [pxtoviewportConfig]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="三、-组件库开发"><a href="#三、-组件库开发" class="headerlink" title="三、 组件库开发"></a>三、 组件库开发</h3><p>在根目录下新建目录：packages，后续开发的组件都放在该目录下</p>
<h4 id="1-工具函数准备"><a href="#1-工具函数准备" class="headerlink" title="1. 工具函数准备"></a>1. 工具函数准备</h4><p>在packages目录下新建utils目录<br>目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">packages</span><br><span class="line">│  index.ts &#x2F;&#x2F; 组件库导出文件</span><br><span class="line">│  list.json &#x2F;&#x2F; 组件列表</span><br><span class="line">└─utils</span><br><span class="line">    │  index.ts &#x2F;&#x2F; 模块导出文件</span><br><span class="line">    │  install.ts &#x2F;&#x2F; vue的install封装函数</span><br><span class="line">	  │  util.ts &#x2F;&#x2F; 其他工具函数</span><br></pre></td></tr></table></figure>

<p>下面分别看看这些文件都是些什么内容。<br>packages/utils/index.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Internal code, don&#x27;t use in your app!</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./install&#x27;</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>packages/utils/install.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; App, Plugin &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> withInstall = (component: <span class="built_in">any</span>): <span class="function"><span class="params">Plugin</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">install</span>(<span class="params">app: App</span>)</span> &#123;</span><br><span class="line">      app.component(component.name, component);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>packages/utils/util.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getImageUrl = (src: <span class="built_in">string</span>): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> URL(src, <span class="keyword">import</span>.meta.url).href</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ku-button组件开发"><a href="#2-ku-button组件开发" class="headerlink" title="2. ku-button组件开发"></a>2. ku-button组件开发</h4><p>在packages目录下新建Button目录<br>目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">packages</span><br><span class="line">│  index.ts &#x2F;&#x2F; 组件库导出文件</span><br><span class="line">│  list.json &#x2F;&#x2F; 组件列表</span><br><span class="line">└─Button</span><br><span class="line">    │  index.ts &#x2F;&#x2F; 模块导出文件</span><br><span class="line">    │  </span><br><span class="line">    ├─demo</span><br><span class="line">    │      base.vue &#x2F;&#x2F; 实例</span><br><span class="line">    │      </span><br><span class="line">    ├─docs</span><br><span class="line">    │      README.md &#x2F;&#x2F; 组件文档</span><br><span class="line">    │      </span><br><span class="line">    └─src</span><br><span class="line">            index.tsx &#x2F;&#x2F; 组件本体</span><br><span class="line">            index.less &#x2F;&#x2F; 组件样式</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下面分别看看这些文件都是些什么内容。<br>packages/Button/src/index.tsx<br>该文件是组件的本体，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&#x27;KuButton&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 启用了类型推导</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">// message: String</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  emits: &#123;</span><br><span class="line">    <span class="function"><span class="title">click</span>(<span class="params">payload: &#123; event: Event &#125;</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 执行运行时校验</span></span><br><span class="line">      <span class="keyword">return</span> payload.event</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params">props, &#123; emit, slots &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="function">(<span class="params">event: Event</span>) =&gt;</span> &#123;</span><br><span class="line">      emit(<span class="string">&#x27;click&#x27;</span>, &#123; event &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ku-button&quot;</span> onClick=&#123;handleClick&#125; &gt;</span><br><span class="line">        &#123; slots.default ? slots.default() : <span class="literal">null</span> &#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>packages/Button/src/index.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ku-button</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: gray;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid gray;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2000px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">  <span class="attribute">transition</span>: all ease .<span class="number">3s</span>;</span><br><span class="line">  user-select: <span class="attribute">none;</span></span><br><span class="line"><span class="attribute">  cursor</span>: pointer;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: gray;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>packages/Button/index.ts<br>为了让组件库既允许完整引入：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.less&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> KudzuUI <span class="keyword">from</span> <span class="string">&#x27;../packages&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(KudzuUI).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>也允许按需引入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Button &#125; from &#39;kudzu-ui&#39;</span><br><span class="line"></span><br><span class="line">Vue.component(&#39;ku-button&#39;, Button)</span><br></pre></td></tr></table></figure>

<p>因此需要为每一个组件定义一个 VuePlugin 的引用方式。package/Button/index.ts 的内容如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&#x27;@kudzu/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">&#x27;./src/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> kuButton = withInstall(Button)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Button &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>补充：配置别名@kudzu</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;.&quot;</span>, <span class="comment">// This must be specified if &quot;paths&quot; is.</span></span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@kudzu/*&quot;</span>: [<span class="string">&quot;packages/*&quot;</span>],</span><br><span class="line">      <span class="string">&quot;@examples/*&quot;</span>: [<span class="string">&quot;examples/*&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;@kudzu&#x27;</span>: path.resolve(__dirname, <span class="string">&#x27;./packages&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>packages/index.ts<br>该文件是作为组件库本身的导出文件，它默认导出了一个 VuePlugin，同时也导出了不同的组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 根据 /packages 目录下的组件所生成的模块导出，请勿手动修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; App, Plugin &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; KuButtonPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;./components/Button&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> kuPlugin: Plugin = &#123;</span><br><span class="line">  <span class="function"><span class="title">install</span>(<span class="params">app: App</span>)</span> &#123;</span><br><span class="line">    KuButtonPlugin.install?.(app)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> kuPlugin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./components/Button&#x27;</span></span><br></pre></td></tr></table></figure>
<p>/packages/list.json<br>最后就是组件库的一个记述文件，用来记录了它里面组件的各种说明，这个我们后面会用到：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;compName&quot;</span>: <span class="string">&quot;Button&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;compCnName&quot;</span>: <span class="string">&quot;按钮&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;compDesc&quot;</span>: <span class="string">&quot;这是一个按钮&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;compClassName&quot;</span>: <span class="string">&quot;ku-button&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>完成了上述组件库目录的初始化以后，此时我们的 Kudzu-UI 是已经可以被业务侧直接使用了。<br>回到根目录下找到 src/main.ts 文件，我们把整个 Kudzu-UI 引入：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.less&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> KudzuUI <span class="keyword">from</span> <span class="string">&#x27;../packages&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(KudzuUI).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>改写 src/App.tsx，使用 <ku-button> 试一下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueLogo <span class="keyword">from</span> <span class="string">&#x27;./assets/vue.svg&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./App.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;div id=<span class="string">&quot;App&quot;</span> <span class="class"><span class="keyword">class</span></span>=&#123;styles.App&#125;&gt;</span><br><span class="line">        &lt;ku-button onClick=&#123;<span class="function">(<span class="params">a: Event</span>) =&gt;</span> <span class="built_in">console</span>.log(a)&#125;&gt;Kudzu UI Button&lt;/ku-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>运行 yarn dev 开启 Vite 的服务器以后，就可以直接在浏览器上看到效果了：<br><img src="8.png"></p>
<h4 id="3-实时可交互式文档"><a href="#3-实时可交互式文档" class="headerlink" title="3. 实时可交互式文档"></a>3. 实时可交互式文档</h4><p>一个组件库肯定不止有 Button 一种组件，每个组件都应该有它独立的文档。这个文档不仅有对组件各项功能的描述，更应该具有组件预览、组件代码查看等功能，我们可以把这种文档称之为“可交互式文档”。同时为了良好的组件开发体验，我们希望这个文档是实时的，这边修改代码，那边就可以在文档里实时地看到最新的效果。接下来我们就来实现这么一个功能。</p>
<p>将src目录重命名为examples目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">KUDZU-UI</span><br><span class="line">│  .gitignore</span><br><span class="line">│  index.html</span><br><span class="line">│  package-lock.json</span><br><span class="line">│  package.json</span><br><span class="line">│  README.md</span><br><span class="line">│  tsconfig.json</span><br><span class="line">│  tsconfig.node.json</span><br><span class="line">│  vite.config.ts</span><br><span class="line">│  yarn-error.log</span><br><span class="line">│  yarn.lock</span><br><span class="line">├─examples</span><br><span class="line">│  │  App.module.less</span><br><span class="line">│  │  App.tsx</span><br><span class="line">│  │  main.ts</span><br><span class="line">│  │  style.less</span><br><span class="line">│  │  vite-env.d.ts</span><br><span class="line">│  │  </span><br><span class="line">│  ├─assets</span><br><span class="line">│  │      vue.svg</span><br><span class="line">│  │      </span><br><span class="line">│  └─components</span><br><span class="line">├─packages</span><br><span class="line">│  │  index.ts</span><br><span class="line">│  │  list.json</span><br><span class="line">│  │  tree.md</span><br><span class="line">│  │  </span><br><span class="line">│  ├─Button</span><br><span class="line">│  │  │  index.ts</span><br><span class="line">│  │  │  </span><br><span class="line">│  │  ├─demo</span><br><span class="line">│  │  │      base.tsx</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  ├─docs</span><br><span class="line">│  │  │      README.md</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  └─src</span><br><span class="line">│  │          index.module.less</span><br><span class="line">│  │          index.tsx</span><br><span class="line">│  │          </span><br><span class="line">│  └─utils</span><br><span class="line">│          index.ts</span><br><span class="line">│          install.ts</span><br><span class="line">│          typescript.ts</span><br><span class="line">│          </span><br><span class="line">└─public</span><br><span class="line">        vite.svg</span><br></pre></td></tr></table></figure>
<p>修改对应配置文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;ESNext&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;ESNext&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;Node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;ESNext&quot;</span>, <span class="string">&quot;DOM&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;examples/**/*.ts&quot;</span>, <span class="string">&quot;examples/**/*.d.ts&quot;</span>, <span class="string">&quot;examples/**/*.tsx&quot;</span>, <span class="string">&quot;examples/**/*.vue&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;paths&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@kudzu/*&quot;</span>: [<span class="string">&quot;packages/*&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;references&quot;</span>: [&#123; <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;./tsconfig.node.json&quot;</span> &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>修改引用<br>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Kudzu UI<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/examples/main.ts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>引入vue-router<br>组件的文档一般是用 Markdown 来写，在这里也不例外。我们希望一个 Markdown 一个页面，因此需要使用 vue-router 来实现路由控制。<br>安装<br><code>yarn add vue-router@latest</code></p>
<blockquote>
<p>@latest表示最新版本<br>在根目录的 examples目录下新建 router.ts，写入如下代码：</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory, RouterOptions &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [&#123;</span><br><span class="line">  title: <span class="string">&#x27;按钮&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;Button&#x27;</span>,</span><br><span class="line">  path: <span class="string">&#x27;/components/Button&#x27;</span>,</span><br><span class="line">  component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">`@kudzu/Button/docs/README.md`</span>),</span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerConfig = &#123;</span><br><span class="line">  history: createWebHistory(),</span><br><span class="line">  routes,</span><br><span class="line">  <span class="function"><span class="title">scrollBehavior</span>(<span class="params">to: <span class="built_in">any</span>, <span class="keyword">from</span>: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.path !== <span class="keyword">from</span>.path) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">top</span>: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(routerConfig <span class="keyword">as</span> RouterOptions)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<p>修改ts配置文件<br>tsconfig.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;ESNext&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;ESNext&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;Node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;preserve&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;ESNext&quot;</span>, <span class="string">&quot;DOM&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;examples/**/*.ts&quot;</span>, <span class="string">&quot;examples/**/*.d.ts&quot;</span>, <span class="string">&quot;examples/**/*.tsx&quot;</span>, <span class="string">&quot;examples/**/*.vue&quot;</span>, </span><br><span class="line">    <span class="string">&quot;packages/**/*.ts&quot;</span>, <span class="string">&quot;packages/**/*.d.ts&quot;</span>, <span class="string">&quot;packages/**/*.tsx&quot;</span>, <span class="string">&quot;packages/**/*.vue&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;paths&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@kudzu/*&quot;</span>: [<span class="string">&quot;packages/*&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;references&quot;</span>: [&#123; <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;./tsconfig.node.json&quot;</span> &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ps: 页面引用报错处理，添加对应声明即可<br>examples/vite-en.d.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="keyword">type</span> &#123; DefineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> component: DefineComponent&lt;&#123;&#125;, &#123;&#125;, <span class="built_in">any</span>&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&quot;*.less&quot;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> classes: &#123; <span class="keyword">readonly</span> [key: <span class="built_in">string</span>]: <span class="built_in">string</span> &#125;;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> classes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&#x27;*.md&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="keyword">type</span> &#123; ComponentOptions &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> Component: ComponentOptions</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&quot;*.json&quot;</span></span><br></pre></td></tr></table></figure>

<p> 解析markdown<br>由于在路由文件中引入了一个 Markdown 文件，这个在默认的 Vite 配置里是无效的，我们需要引入 vite-plugin-md 插件来解析 Markdown 文件并把它变成 Vue 文件。<br>安装插件<br><code>yarn add vite-plugin-md -D</code><br>回到根目录下找到 vite.config.ts，配置该插件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> Markdown <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-md&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(&#123; <span class="attr">include</span>: [<span class="regexp">/\.vue$/</span>, <span class="regexp">/\.md$/</span>] &#125;),</span><br><span class="line">    Markdown(),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时可能会遇到一个报错：<br><code>Cannot find package &#39;@rollup/pluginutils&#39;</code><br>安装对应的依赖即可<br><code>yarn add @rollup/pluginutils -D</code><br>这样配置以后，任意的 Markdown 文件都能像一个 Vue 文件一样被使用了。</p>
<p>页面结构和样式调整<br>回到examples/App.tsx，稍作改写，增加一个侧边栏和主区域：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./App.module.less&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ComponentList <span class="keyword">from</span> <span class="string">&#x27;@kudzu/list.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> ComponentsItem &#123;</span><br><span class="line">  compName: <span class="built_in">String</span>;</span><br><span class="line">  compZhName: <span class="built_in">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> LinkItem &#123;</span><br><span class="line">  path: <span class="built_in">String</span>;</span><br><span class="line">  name: <span class="built_in">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">      links: ComponentList.map(<span class="function">(<span class="params">item: ComponentsItem</span>) =&gt;</span> (&#123;</span><br><span class="line">        path: <span class="string">`/components/<span class="subst">$&#123;item.compName&#125;</span>`</span>,</span><br><span class="line">        name: item.compZhName</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;div id=<span class="string">&quot;App&quot;</span> <span class="class"><span class="keyword">class</span></span>=&#123;styles.App&#125;&gt;</span><br><span class="line">        &lt;aside <span class="class"><span class="keyword">class</span></span>=&#123;styles.aside&#125;&gt;</span><br><span class="line">          &#123; data.links.map(<span class="function">(<span class="params">v: LinkItem</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">key</span>=<span class="string">&#123;v.path&#125;</span> <span class="attr">to</span>=<span class="string">&#123;v.path&#125;</span>&gt;</span>&#123; v.name &#125;<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line">            &#125;) </span><br><span class="line">          &#125;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;main <span class="class"><span class="keyword">class</span></span>=&#123;styles.main&#125;&gt;</span><br><span class="line">          &lt;router-view /&gt;</span><br><span class="line">        &lt;/main&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>样式重写<br>examples/style.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cssreset</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">font</span>: normal <span class="number">14px</span>/<span class="number">1.5</span> <span class="string">&#x27;Lucida Console&#x27;</span>, <span class="string">&quot;monospace&quot;</span>, <span class="string">&quot;STKaiti&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-tag">div</span>,</span><br><span class="line"><span class="selector-tag">span</span>,</span><br><span class="line"><span class="selector-tag">applet</span>,</span><br><span class="line"><span class="selector-tag">object</span>,</span><br><span class="line"><span class="selector-tag">iframe</span>,</span><br><span class="line"><span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-tag">h3</span>,</span><br><span class="line"><span class="selector-tag">h4</span>,</span><br><span class="line"><span class="selector-tag">h5</span>,</span><br><span class="line"><span class="selector-tag">h6</span>,</span><br><span class="line"><span class="selector-tag">p</span>,</span><br><span class="line"><span class="selector-tag">blockquote</span>,</span><br><span class="line"><span class="selector-tag">pre</span>,</span><br><span class="line"><span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">abbr</span>,</span><br><span class="line"><span class="selector-tag">acronym</span>,</span><br><span class="line"><span class="selector-tag">address</span>,</span><br><span class="line"><span class="selector-tag">big</span>,</span><br><span class="line"><span class="selector-tag">cite</span>,</span><br><span class="line"><span class="selector-tag">code</span>,</span><br><span class="line"><span class="selector-tag">del</span>,</span><br><span class="line"><span class="selector-tag">dfn</span>,</span><br><span class="line"><span class="selector-tag">em</span>,</span><br><span class="line"><span class="selector-tag">img</span>,</span><br><span class="line"><span class="selector-tag">ins</span>,</span><br><span class="line"><span class="selector-tag">kbd</span>,</span><br><span class="line"><span class="selector-tag">q</span>,</span><br><span class="line"><span class="selector-tag">s</span>,</span><br><span class="line"><span class="selector-tag">samp</span>,</span><br><span class="line"><span class="selector-tag">small</span>,</span><br><span class="line"><span class="selector-tag">strike</span>,</span><br><span class="line"><span class="selector-tag">strong</span>,</span><br><span class="line"><span class="selector-tag">sub</span>,</span><br><span class="line"><span class="selector-tag">sup</span>,</span><br><span class="line"><span class="selector-tag">tt</span>,</span><br><span class="line"><span class="selector-tag">var</span>,</span><br><span class="line"><span class="selector-tag">b</span>,</span><br><span class="line"><span class="selector-tag">u</span>,</span><br><span class="line"><span class="selector-tag">i</span>,</span><br><span class="line"><span class="selector-tag">center</span>,</span><br><span class="line"><span class="selector-tag">dl</span>,</span><br><span class="line"><span class="selector-tag">dt</span>,</span><br><span class="line"><span class="selector-tag">dd</span>,</span><br><span class="line"><span class="selector-tag">ol</span>,</span><br><span class="line"><span class="selector-tag">ul</span>,</span><br><span class="line"><span class="selector-tag">li</span>,</span><br><span class="line"><span class="selector-tag">fieldset</span>,</span><br><span class="line"><span class="selector-tag">form</span>,</span><br><span class="line"><span class="selector-tag">label</span>,</span><br><span class="line"><span class="selector-tag">legend</span>,</span><br><span class="line"><span class="selector-tag">table</span>,</span><br><span class="line"><span class="selector-tag">caption</span>,</span><br><span class="line"><span class="selector-tag">tbody</span>,</span><br><span class="line"><span class="selector-tag">tfoot</span>,</span><br><span class="line"><span class="selector-tag">thead</span>,</span><br><span class="line"><span class="selector-tag">tr</span>,</span><br><span class="line"><span class="selector-tag">th</span>,</span><br><span class="line"><span class="selector-tag">td</span>,</span><br><span class="line"><span class="selector-tag">article</span>,</span><br><span class="line"><span class="selector-tag">aside</span>,</span><br><span class="line"><span class="selector-tag">canvas</span>,</span><br><span class="line"><span class="selector-tag">details</span>,</span><br><span class="line"><span class="selector-tag">embed</span>,</span><br><span class="line"><span class="selector-tag">figure</span>,</span><br><span class="line"><span class="selector-tag">figcaption</span>,</span><br><span class="line"><span class="selector-tag">footer</span>,</span><br><span class="line"><span class="selector-tag">header</span>,</span><br><span class="line"><span class="selector-tag">menu</span>,</span><br><span class="line"><span class="selector-tag">nav</span>,</span><br><span class="line"><span class="selector-tag">output</span>,</span><br><span class="line"><span class="selector-tag">ruby</span>,</span><br><span class="line"><span class="selector-tag">section</span>,</span><br><span class="line"><span class="selector-tag">summary</span>,</span><br><span class="line"><span class="selector-tag">time</span>,</span><br><span class="line"><span class="selector-tag">mark</span>,</span><br><span class="line"><span class="selector-tag">audio</span>,</span><br><span class="line"><span class="selector-tag">video</span>,</span><br><span class="line"><span class="selector-tag">input</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">vertical-align</span>: baseline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* HTML5 display-role reset for older browsers */</span></span><br><span class="line"><span class="selector-tag">article</span>,</span><br><span class="line"><span class="selector-tag">aside</span>,</span><br><span class="line"><span class="selector-tag">details</span>,</span><br><span class="line"><span class="selector-tag">figcaption</span>,</span><br><span class="line"><span class="selector-tag">figure</span>,</span><br><span class="line"><span class="selector-tag">footer</span>,</span><br><span class="line"><span class="selector-tag">header</span>,</span><br><span class="line"><span class="selector-tag">menu</span>,</span><br><span class="line"><span class="selector-tag">nav</span>,</span><br><span class="line"><span class="selector-tag">section</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">blockquote</span>,</span><br><span class="line"><span class="selector-tag">q</span> &#123;</span><br><span class="line">  <span class="attribute">quotes</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">blockquote</span>:<span class="selector-tag">before</span>,</span><br><span class="line"><span class="selector-tag">blockquote</span>:<span class="selector-tag">after</span>,</span><br><span class="line"><span class="selector-tag">q</span>:<span class="selector-tag">before</span>,</span><br><span class="line"><span class="selector-tag">q</span>:<span class="selector-tag">after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">border-collapse</span>: collapse;</span><br><span class="line">  <span class="attribute">border-spacing</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* custom */</span></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#7e8c8d</span>;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::<span class="selector-tag">-webkit-scrollbar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::<span class="selector-tag">-webkit-scrollbar-track-piece</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">  -webkit-<span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::<span class="selector-tag">-webkit-scrollbar-thumb</span>:<span class="selector-tag">vertical</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: rgba(<span class="number">125</span>, <span class="number">125</span>, <span class="number">125</span>, <span class="number">0.7</span>);</span><br><span class="line">  -webkit-<span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::<span class="selector-tag">-webkit-scrollbar-thumb</span>:<span class="selector-tag">horizontal</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: rgba(<span class="number">125</span>, <span class="number">125</span>, <span class="number">125</span>, <span class="number">0.7</span>);</span><br><span class="line">  -webkit-<span class="attribute">border-radius</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  -webkit-text-size-adjust: <span class="attribute">none;</span></span><br><span class="line"><span class="attribute">  -webkit-tap-highlight-color</span>: rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们往 /packages/Button/docs/README.md 里面随便写点东西：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 按钮组件</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ku-button</span>&gt;</span></span>我是自定义按钮<span class="xml"><span class="tag">&lt;/<span class="name">ku-button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>完成以后就能在浏览器上看到效果了：<br><img src="9.png"></p>
<p>5 添加文档首页<br>examples/docs/get-start.md</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section"># 葛藤UI</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 安装</span></span><br><span class="line"></span><br><span class="line"><span class="section">### npm 安装</span></span><br><span class="line">推荐使用 npm 的方式安装，它能更好地和 webpack 打包工具配合使用。</span><br><span class="line"></span><br><span class="line">\<span class="code">`npm i kudzu-ui -S\`</span></span><br><span class="line"></span><br><span class="line"><span class="section">### yarn 安装</span></span><br><span class="line"></span><br><span class="line">\<span class="code">`yarn add kudzu-ui -S\`</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 使用</span></span><br><span class="line"></span><br><span class="line">在 main.ts 中写入以下内容：</span><br><span class="line">\<span class="code">```javascript</span></span><br><span class="line"><span class="code">import &#123; createApp &#125; from &#x27;vue&#x27;</span></span><br><span class="line"><span class="code">import &#x27;@src/style.less&#x27;</span></span><br><span class="line"><span class="code">import App from &#x27;@src/App.vue&#x27;</span></span><br><span class="line"><span class="code">import router from &#x27;@src/router&#x27;</span></span><br><span class="line"><span class="code">import KudzuUI from &#x27;kudzu-ui&#x27;</span></span><br><span class="line"><span class="code">import &#x27;kudzu-ui/lib/style.css&#x27;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">createApp(App).use(router).use(KudzuUI).mount(&#x27;#app&#x27;)</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">\```</span></span><br></pre></td></tr></table></figure>

<p>examples/router.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 根据 /packages 目录下的组件所生成的组件类侧边导航栏配置，请勿手动修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">import</span> &#123; createRouter, createWebHistory, RouterOptions &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"> <span class="keyword">import</span> Index <span class="keyword">from</span> <span class="string">&#x27;./views/Index&#x27;</span></span><br><span class="line"> <span class="keyword">import</span> GetStart <span class="keyword">from</span> <span class="string">&#x27;./docs/get-start.md&#x27;</span></span><br><span class="line"> <span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">&#x27;../packages/components/Button/docs/README.md&#x27;</span> <span class="comment">// 单独列出，处理github pages的点击无法跳转问题</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;Index&#x27;</span>,</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    component: Index,</span><br><span class="line">    redirect: <span class="string">&#x27;/get-start&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">&#x27;起步&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;GetStart&#x27;</span>,</span><br><span class="line">    path: <span class="string">&#x27;/get-start&#x27;</span>,</span><br><span class="line">    component: GetStart,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">&#x27;按钮&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;Button&#x27;</span>,</span><br><span class="line">    path: <span class="string">&#x27;/components/button&#x27;</span>,</span><br><span class="line">    component: Button,</span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> routerConfig = &#123;</span><br><span class="line">  history: createWebHistory(<span class="keyword">import</span>.meta.env.BASE_URL),</span><br><span class="line">  routes,</span><br><span class="line">  <span class="function"><span class="title">scrollBehavior</span>(<span class="params">to: <span class="built_in">any</span>, <span class="keyword">from</span>: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.path !== <span class="keyword">from</span>.path) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">top</span>: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(routerConfig <span class="keyword">as</span> RouterOptions)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="10.png"></p>
<p>由于我们全局引入了Kudzu UI，所以里面所注册的自定义组件都可以直接在 Markdown 文件中像普通 HTML 标签一样被写入并被正确渲染。但是这里也有另一个问题，就是这些组件都是静态的无事件的，无法执行 JS 逻辑。比如当我想要实现点击按钮触发 click 事件然后弹一个告警弹窗出来，是无法直接这么写的：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 按钮组件</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">ku-button</span> @<span class="attr">click</span>=<span class="string">&quot;() =&gt;</span></span></span> &#123; alert(123) &#125;&quot;&gt;我是自定义按钮<span class="xml"><span class="tag"><span class="string">&lt;/ku-button&gt;</span></span></span></span><br></pre></td></tr></table></figure>

<p>那怎么办呢？还记得刚刚引入的解析 Markdown 的插件 vite-plugin-md 吗？仔细看它的文档，它是支持在 Markdown 里面写 setup 函数的！因此我们可以把需要执行 JS 逻辑的代码封装成一个组件，然后在 Markdown 里通过 setup 来引入。<br>首先在 packages/Button/demo目录下新建一个 base.vue：</p>
<blockquote>
<p>这边不像组件封装，需要较高的灵活度，故采用vue格式，便于将组件所有资源（dom结构，css样式和对应js事件）放在同一个文件中进行维护</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;base-ku-button&quot;&gt;</span><br><span class="line">    &lt;ku-button @click&#x3D;&quot;onClick(1)&quot;&gt;第一个&lt;&#x2F;ku-button&gt;</span><br><span class="line">    &lt;ku-button @click&#x3D;&quot;onClick(2)&quot;&gt;第二个&lt;&#x2F;ku-button&gt;</span><br><span class="line">    &lt;ku-button @click&#x3D;&quot;onClick(3)&quot;&gt;第三个&lt;&#x2F;ku-button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">defineOptions(&#123;</span><br><span class="line">  name: &#39;BaseButton&#39;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const onClick &#x3D; (num: Number) &#x3D;&gt; &#123; console.log(&#96;我是第 $&#123;num&#125; 个自定义按钮&#96;) &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;</span><br><span class="line">.base-ku-button &#123;</span><br><span class="line">  display: grid;</span><br><span class="line">  grid-template-columns: 100px 100px 100px;</span><br><span class="line">  grid-gap: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>为了给组件命名，我们使用了宏defineOptions，而defineOptions的使用需要插件的支持，这边安装整个插件，后续若需要使用其他功能，便于扩展<br>安装插件<br><code>yarn add unplugin-vue-macros -D</code><br>配置插件，注意这边将vue相关的初始化都移动到该插件下面<br>vite.config.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pxtoviewport <span class="keyword">from</span> <span class="string">&#x27;postcss-px-to-viewport&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Markdown <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-md&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueMacros <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-macros/vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pxtoviewportConfig = pxtoviewport(&#123;</span><br><span class="line">  viewportWidth: <span class="number">1366</span>, <span class="comment">// 设计稿的视口宽度</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    VueMacros(&#123;</span><br><span class="line">      plugins: &#123;</span><br><span class="line">        vue: vue(&#123; <span class="attr">include</span>: [<span class="regexp">/\.vue$/</span>, <span class="regexp">/\.md$/</span>] &#125;),</span><br><span class="line">        vueJsx: vueJsx(&#123;</span><br><span class="line">          <span class="comment">// options are passed on to @vue/babel-plugin-jsx</span></span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    Markdown(),</span><br><span class="line">  ],</span><br><span class="line">  css: &#123;</span><br><span class="line">    postcss: &#123;</span><br><span class="line">      plugins: [pxtoviewportConfig]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;@kudzu&#x27;</span>: path.resolve(__dirname, <span class="string">&#x27;./packages&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>tsconfig.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;unplugin-vue-macros/macros-global&quot;</span> <span class="comment">/* ... */</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 Markdown 里把它引进来：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span></span><br><span class="line">import BaseKudzuButton from &#x27;../demo/base.vue&#x27;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 按钮组件</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">BaseKudzuButton</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>最后就能实现点击响应了。<br><img src="11.png"><br>与此同时，如果我们对 <ku-button /> 的本体 Vue 文件进行任何的修改，都能够实时在文档中体现出来。</p>
<p>四、代码预览功能<br>可交互式文档已经基本弄好了，但还有一个问题，就是不能直观地预览代码。你可能会说，要预览代码很简单啊，直接在 Markdown 里面把代码贴进去不就好了？话虽如此并没有错，但是秉承着“偷懒才是第一生产力”，估计没有人喜欢把自己写过的代码再抄一遍，肯定是希望能够有个办法既能够在文档里把所写的 demo 展示出来，又能直接看到它的代码，比如说这样：<br><img src="12.png"></p>
<p>只要把组件放进一个 <code>&lt;Preview /&gt;</code> 标签内就能直接展示组件的代码，同时还具有代码高亮的功能，这才是可交互式文档真正具备的样子！接下来我们就来研究一下应该如何实现这个功能。<br>在 Vite 的开发文档里有记载到，它支持在资源的末尾加上一个后缀来控制所引入资源的类型。比如可以通过 import xx from ‘xx?raw’ 以字符串形式引入 xx 文件。基于这个能力，我们可以在 <code>&lt;Preview /&gt;</code> 组件中获取所需要展示的文件源码。</p>
<h4 id="1-新建一个-Preview-jsx-文件"><a href="#1-新建一个-Preview-jsx-文件" class="headerlink" title="1. 新建一个 Preview.jsx 文件"></a>1. 新建一个 Preview.jsx 文件</h4><p>首先来新建一个 Preview.jsx 文件，其核心内容是通过 Props 拿到源码的路径，然后通过动态 import 的方式把源码拿到。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, onMounted, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">/** 组件名称 */</span></span><br><span class="line">    compName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="built_in">require</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/** 要显示代码的组件 */</span></span><br><span class="line">    demoName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="built_in">require</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">      sourceCode: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onMounted(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      data.sourceCode =  (</span><br><span class="line">        <span class="comment">// 此处只能使用相对路径或者绝对路径</span></span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`../../packages/<span class="subst">$&#123;props.compName&#125;</span>/demo/<span class="subst">$&#123;props.demoName&#125;</span>.vue?raw`</span>)</span><br><span class="line">      ).default</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;pre&gt;&#123; data.sourceCode &#125;&lt;/pre&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>早期版本可能需要 @vite-ignore 的注释<br>因为 Vite 基于 Rollup，在 Rollup 当中动态 import 是被要求传入确定的路径，不能是这种动态拼接的路径。具体原因和其静态分析有关，感兴趣的同学可以自行搜索了解。此处加上该注释则会忽略 Rollup 的要求而直接支持该写法。但是这样的写法在 dev 模式下可用，待真正执行 build 构建了以后再运行会发现报错。其原因也是同样的，由于 Rollup 无法进行静态分析，因此它无法在构建阶段处理需要动态 import 的文件，导致会出现找不到对应资源的情况。只好判断环境变量，在 build 模式下通过 fetch 请求文件的源码来绕过。改写后如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isDev = <span class="keyword">import</span>.meta.env.MODE === <span class="string">&#x27;development&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isDev) &#123;</span><br><span class="line">  <span class="built_in">this</span>.sourceCode = (</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">import</span>(<span class="comment">/* @vite-ignore */</span> <span class="string">`../../packages/<span class="subst">$&#123;<span class="built_in">this</span>.compName&#125;</span>/docs/<span class="subst">$&#123;<span class="built_in">this</span>.demoName&#125;</span>.vue?raw`</span>)</span><br><span class="line">  ).default;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.sourceCode = <span class="keyword">await</span> fetch(<span class="string">`/packages/<span class="subst">$&#123;<span class="built_in">this</span>.compName&#125;</span>/docs/<span class="subst">$&#123;<span class="built_in">this</span>.demoName&#125;</span>.vue`</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.text());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>假设构建后的输出目录为 /docs，记得在构建后也要把 /packages 目录复制过去，否则在 build 模式下运行会出现 404 的情况。</p>
<p>可能又有同学会问，为什么要这么麻烦，直接在 dev 模式下也走 fetch 请求的方式不行么？答案是不行，因为在 Vite 的 dev 模式下，它本来就是通过 http 请求去拉取文件资源并处理完了才给到了业务的那一层。因此在 dev 模式下通过 fetch 拿到的 Vue 文件源码是已经被 Vite 给处理过的。<br>拿到了源码以后，只需要展示出来即可：<br>packages/Button/docs/README.md</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span></span><br><span class="line">import Preview from &#x27;@examples/components/Preview&#x27;</span><br><span class="line">import BaseKudzuButton from &#x27;../demo/base.vue&#x27;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 按钮组件</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">BaseKudzuButton</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Preview</span> <span class="attr">comp-name</span>=<span class="string">&#x27;Button&#x27;</span> <span class="attr">demo-name</span>=<span class="string">&#x27;base&#x27;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="13.png"></p>
<p>2 高亮代码<br>但是这样的源码展示非常丑，只有干巴巴的字符，我们有必要给它们加个高亮。高亮的方案我选择了 PrismJS，它非常小巧又灵活，只需要引入一个相关的 CSS 主题文件，然后执行 Prism.highlightAll() 即可。本例所使用的 CSS 主题文件已经放置在仓库，可以自行取用。<br>回到项目，执行<br><code>yarn add prismjs -D</code><br>安装 PrismJS，然后在 <code>&lt;Preview /&gt;</code> 组件中引入：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> PrismJS <span class="keyword">from</span> <span class="string">&#x27;prismjs&#x27;</span> <span class="comment">// markdown高亮</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@examples/assets/prism.css&#x27;</span> <span class="comment">// 高亮主题</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">setup</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    onMounted(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">// 省略。。。</span></span><br><span class="line">      <span class="keyword">await</span> nextTick() <span class="comment">// 确保在源码都渲染好了以后再执行高亮</span></span><br><span class="line">      PrismJS.highlightAll()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此处ts会报错：添加对应声明即可<br>vite-env.d.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&quot;prismjs&quot;</span></span><br></pre></td></tr></table></figure>
<p>由于 PrismJS 没有支持 Vue 文件的声明，因此 Vue 的源码高亮是通过将其设置为 HTML 类型来实现的。在 <code>&lt;Preview /&gt;</code> 组件的模板中我们直接指定源码的类型为 HTML：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;pre class&#x3D;&quot;language-html&quot;&gt;&lt;code class&#x3D;&quot;language-html&quot;&gt;&#123;data.sourceCode&#125;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt; </span><br></pre></td></tr></table></figure>
<p>这样调整了以后，PrismJS 就会自动高亮源码了。</p>
<h4 id="3-优化使用方式以及样式"><a href="#3-优化使用方式以及样式" class="headerlink" title="3. 优化使用方式以及样式"></a>3. 优化使用方式以及样式</h4><p>更进一步，在Preview中添加插槽和相应样式<br>examples/components/Preview.tsx</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, onMounted, reactive, nextTick, ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> PrismJS <span class="keyword">from</span> <span class="string">&#x27;prismjs&#x27;</span> <span class="comment">// markdown高亮</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@examples/assets/prism.css&#x27;</span> <span class="comment">// 高亮主题</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;@examples/components/Preview.module.less&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    <span class="comment">/** 组件名称 */</span></span><br><span class="line">    compName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="built_in">require</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/** 要显示代码的组件 */</span></span><br><span class="line">    demoName: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="built_in">require</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params">props, &#123; slots &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sourceCode = ref&lt;<span class="built_in">any</span>&gt;(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> data = reactive(&#123;</span><br><span class="line">      sourceCode: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      height: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    onMounted(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      data.sourceCode = (</span><br><span class="line">        <span class="comment">// 此处只能使用相对路径或者绝对路径</span></span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`../../packages/<span class="subst">$&#123;props.compName&#125;</span>/demo/<span class="subst">$&#123;props.demoName&#125;</span>.vue?raw`</span>)</span><br><span class="line">      ).default</span><br><span class="line"></span><br><span class="line">      <span class="keyword">await</span> nextTick() <span class="comment">// 确保在源码都渲染好了以后再执行高亮</span></span><br><span class="line">      PrismJS.highlightAll()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> changeSourceCodeStatus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log()</span><br><span class="line">      data.height === <span class="string">&#x27;0&#x27;</span> ? data.height = getComputedStyle(sourceCode.value).height : data.height = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">      nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 确保在源码都渲染好了以后再执行高亮</span></span><br><span class="line">        PrismJS.highlightAll()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> (</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=&#123;style.preview&#125;&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=&#123;style.display&#125;&gt;&#123; slots.default ? slots.default() : <span class="literal">null</span> &#125;&lt;/div&gt;</span><br><span class="line">        &lt;pre </span><br><span class="line">          style=&#123;&#123; <span class="attr">height</span>: data.height, <span class="attr">padding</span>: data.height === <span class="string">&#x27;0&#x27;</span> ? <span class="string">&#x27;0&#x27;</span> : <span class="string">&#x27;20px&#x27;</span> &#125;&#125;</span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;language-html&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;code ref=&#123;sourceCode&#125; <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;language-html&quot;</span>&gt;&#123;data.sourceCode&#125;&lt;/code&gt;</span><br><span class="line">        &lt;/pre&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=&#123;style.control&#125; onClick=&#123;changeSourceCodeStatus&#125;&gt;</span><br><span class="line">          &#123; data.height === <span class="string">&#x27;hide&#x27;</span> ? <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>显示代码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>隐藏代码<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span> &#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>examples/components/Preview.module.less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.preview</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ebebeb</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: .<span class="number">2s</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="number">0</span> rgb(<span class="number">232</span> <span class="number">237</span> <span class="number">250</span> / <span class="number">60%</span>), <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="number">0</span> rgb(<span class="number">232</span> <span class="number">237</span> <span class="number">250</span> / <span class="number">50%</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.display</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">24px</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.control</span> &#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eaeefb</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">44px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">44px</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-bottom-left-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#d3dce6</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    user-select: <span class="attribute">none;</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">    &amp;</span>:hover &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#409eff</span>;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#f9fafc</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="selector-tag">pre</span><span class="selector-attr">[class*=language-]</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: auto;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fafafa</span>;</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">2s</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改调用方式<br>packages/Button/docs/README.md</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span></span><br><span class="line">import Preview from &#x27;@examples/components/Preview&#x27;</span><br><span class="line">import BaseKudzuButton from &#x27;../demo/base.vue&#x27;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 按钮组件</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Preview</span> <span class="attr">comp-name</span>=<span class="string">&#x27;Button&#x27;</span> <span class="attr">demo-name</span>=<span class="string">&#x27;base&#x27;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">BaseKudzuButton</span> /&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">Preview</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>调整后效果如下：<br><img src="15.png"></p>
<h3 id="五、命令式新建组件"><a href="#五、命令式新建组件" class="headerlink" title="五、命令式新建组件"></a>五、命令式新建组件</h3><p>到目前为止，我们的整个“实时可交互式文档”已经搭建完了，是不是意味着可以交付给其他同学进行真正的组件开发了呢？假设你是另一个开发同学，我跟你说：“你只要在这里，这里和这里新建这些文件，然后在这里和这里修改一下配置就可以新建一个组件了！”你会不会很想打人？作为组件开发者的你，并不想关心我的配置是怎样的，框架是怎么跑起来的，只希望能够在最短时间内就能够初始化一个新的组件然后着手开发。为了满足这个想法，我们有必要把之前处理的步骤变得更加自动化一些，学习成本更低一些。</p>
<p>整体思路是：在终端回答了三个问题后，自动就生成了一个新的组件 Foo。与此同时，无论是新建文件还是修改配置都是一键完成，完全不需要人工干预，接下来的工作只需要围绕 Foo 这一个新组件开展即可。我们可以把这种一键生成组件的方式成为“命令式新建组件”。<br>要实现这个功能，我们 inquirer 和 handlebars 这两个工具。前者用于创建交互式终端提出问题并收集答案；后者用于根据模板生成内容。我们首先来做交互式终端。</p>
<blockquote>
<p>node环境下使用import/export<br>用前须知<br>● Node 版本需在 9.0 及以上<br>● 不加 loader 时候，使用 import/export 的文件后缀名必须为 .mjs</p>
</blockquote>
<p>回到根目录下，新建 /script/generater 目录，然后创建一个 infoCollector.mjs 文件：</p>
<figure class="highlight mjs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> inquirer <span class="keyword">from</span> <span class="string">&#x27;inquirer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path, &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span></span><br><span class="line"><span class="keyword">const</span> filename = fileURLToPath(<span class="keyword">import</span>.meta.url)</span><br><span class="line"><span class="keyword">const</span> __dirname = path.dirname(filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> listFilePath = <span class="string">&#x27;../../packages/list.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RegxMap = &#123;</span><br><span class="line">  IS_COMP_NAME: <span class="regexp">/^[A-Z]/</span>,</span><br><span class="line">  IS_COMP_CN_NAME: <span class="regexp">/^[\u4e00-\u9fa5]*$/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> kebabCase = <span class="function"><span class="params">string</span> =&gt;</span> string</span><br><span class="line">  .replace(<span class="regexp">/([a-z])([A-Z])/g</span>, <span class="string">&quot;$1-$2&quot;</span>)</span><br><span class="line">  .replace(<span class="regexp">/[\s_]+/g</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">  .toLowerCase();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> meta = <span class="keyword">await</span> inquirer</span><br><span class="line">    .prompt([</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">        message: <span class="string">&#x27;请输入你要新建的组件名（纯英文，大写开头）：&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;compName&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">validate</span>(<span class="params">answer</span>)</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> done = <span class="built_in">this</span>.async()</span><br><span class="line">          <span class="keyword">const</span> validateRes = RegxMap.IS_COMP_NAME.test(answer)</span><br><span class="line">          <span class="keyword">if</span> (!validateRes) &#123;</span><br><span class="line">            done(<span class="string">&#x27;请按要求输入正确的组件名！&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">const</span> listData = fs.readJSONSync(resolve(__dirname, listFilePath))</span><br><span class="line">          <span class="keyword">if</span> (listData.find(<span class="function"><span class="params">item</span> =&gt;</span> item.compName === answer)) &#123;</span><br><span class="line">            done(<span class="string">&#x27;已存在同名组件，请确认后更换名字再重试。&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          done(<span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">        message: <span class="string">&#x27;请输入你要新建的组件名（中文）：&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;compCnName&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">validate</span>(<span class="params">answer</span>)</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> done = <span class="built_in">this</span>.async()</span><br><span class="line">          <span class="keyword">const</span> validateRes = RegxMap.IS_COMP_CN_NAME.test(answer)</span><br><span class="line">          <span class="keyword">if</span> (!validateRes) &#123;</span><br><span class="line">            done(<span class="string">&#x27;请按要求输入正确的组件名！&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          done(<span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        type: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">        message: <span class="string">&#x27;请输入组件的功能描述：&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;compDesc&#x27;</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="string">&#x27;默认：这是一个新组件&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">  <span class="keyword">const</span> &#123; compName &#125; = meta</span><br><span class="line">  meta.compClassName = kebabCase(compName)</span><br><span class="line">  <span class="keyword">return</span> meta</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 node 运行该文件时，会在终端内依次提出三个组件信息相关的问题，并把答案 compName（组件英文名），compCnName （组件中文名）和 compDesc（组件描述）保存在 meta 对象中并导出。<br>收集到了组件相关信息后，就要通过 handlebars 替换模板中的内容，生成或修改文件了。<br>在 /script/generater 中新建一个 .template 目录，然后根据需要去建立新组件所需的所有文件的模板。在我们的框架中，一个组件的目录是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Foo</span><br><span class="line">├── demo</span><br><span class="line">│   └── base.vue</span><br><span class="line">├── docs</span><br><span class="line">│   ├── README.md</span><br><span class="line">├── index.ts</span><br><span class="line">└── src</span><br><span class="line">    ├── index.tsx</span><br><span class="line">    └── index.less</span><br></pre></td></tr></table></figure>

<p>需要新建 packages/components/src/index.ts.tpl，packages/components/src/index.tsx.tpl，packages/components/src/index.less.tpl，packages/components/docs/README.md.tpl 和 packages/components/demo/base.vue.tpl，examples/router.ts.tpl，packages/index.ts.tpl。同时由于新组件需要一个新的路由，因此router.ts 也是需要一个对应的模板。由于篇幅关系就不全展示了，只挑最核心的 index.ts.tpl 来看看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; withInstall &#125; from &#39;@kudzu&#x2F;utils&#39;</span><br><span class="line">import &#123;&#123; compName &#125;&#125; from &#39;.&#x2F;src&#x2F;index&#39;</span><br><span class="line"></span><br><span class="line">export const Ku&#123;&#123; compName &#125;&#125;Plugin &#x3D; withInstall(&#123;&#123; compName &#125;&#125;)</span><br><span class="line"></span><br><span class="line">export &#123; &#123;&#123; compName &#125;&#125; &#125;</span><br></pre></td></tr></table></figure>

<p>位于双括号<code>&#123;&#123;&#125;&#125;</code> 中的内容最终会被 handlebars 所替换，比如我们已经得知一个新组件的信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compName&quot;: &quot;Button&quot;,</span><br><span class="line">  &quot;compZhName&quot;: &quot;按钮&quot;,</span><br><span class="line">  &quot;compDesc&quot;: &quot;这是一个按钮&quot;,</span><br><span class="line">  &quot;compClassName&quot;: &quot;ku-button&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么模板 index.ts.tpl 最终会被替换成这样：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withInstall &#125; <span class="keyword">from</span> <span class="string">&#x27;@kudzu/utils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">&#x27;./src/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> KuButtonPlugin = withInstall(Button)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Button &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>新建模板替换文件<br>script/generater/tplReplacer.mjs模板替换的代码如下：</p>
<figure class="highlight mjs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> handlebars <span class="keyword">from</span> <span class="string">&#x27;handlebars&#x27;</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs-extra&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path, &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span></span><br><span class="line"><span class="keyword">const</span> filename = fileURLToPath(<span class="keyword">import</span>.meta.url)</span><br><span class="line"><span class="keyword">const</span> __dirname = path.dirname(filename)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件相关</span></span><br><span class="line"><span class="keyword">const</span> getTplFilePath = <span class="function">(<span class="params">meta</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">// docs 目录</span></span><br><span class="line">  readme: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;./.template/packages/components/docs/README.md.tpl&#x27;</span>,</span><br><span class="line">    to: <span class="string">`../../packages/<span class="subst">$&#123;meta.compName&#125;</span>/docs/README.md`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// demo 目录</span></span><br><span class="line">  demo: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;./.template/packages/components/demo/base.vue.tpl&#x27;</span>,</span><br><span class="line">    to: <span class="string">`../../packages/<span class="subst">$&#123;meta.compName&#125;</span>/demo/base.vue`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// src 目录</span></span><br><span class="line">  tsx: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;./.template/packages/components/src/index.tsx.tpl&#x27;</span>,</span><br><span class="line">    to: <span class="string">`../../packages/<span class="subst">$&#123;meta.compName&#125;</span>/src/index.tsx`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  less: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;./.template/packages/components/src/index.less.tpl&#x27;</span>,</span><br><span class="line">    to: <span class="string">`../../packages/<span class="subst">$&#123;meta.compName&#125;</span>/src/index.less`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根目录</span></span><br><span class="line">  index: &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;./.template/packages/components/index.ts.tpl&#x27;</span>,</span><br><span class="line">    to: <span class="string">`../../packages/<span class="subst">$&#123;meta.compName&#125;</span>/index.ts`</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compFilesTplReplacer = <span class="function">(<span class="params">meta</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> filePaths = getTplFilePath(meta)</span><br><span class="line">  <span class="built_in">Object</span>.keys(filePaths).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileTpl = fs.readFileSync(resolve(__dirname, filePaths[key].from), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> fileContent = handlebars.compile(fileTpl)(meta)</span><br><span class="line">    fs.outputFile(resolve(__dirname, filePaths[key].to), fileContent, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取 packages/list.json 并更新</span></span><br><span class="line"><span class="keyword">const</span> listJsonTplReplacer = <span class="function">(<span class="params">meta</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> listFilePath = <span class="string">&#x27;../../packages/list.json&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> listFileTpl = fs.readFileSync(resolve(__dirname, listFilePath), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> listFileContent = <span class="built_in">JSON</span>.parse(listFileTpl)</span><br><span class="line">  listFileContent.push(meta)</span><br><span class="line">  <span class="keyword">const</span> newListFileContentFile = <span class="built_in">JSON</span>.stringify(listFileContent, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">  fs.writeFile(resolve(__dirname, listFilePath), newListFileContentFile, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> listFileContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新 router.ts</span></span><br><span class="line"><span class="keyword">const</span> routerTplReplacer = <span class="function">(<span class="params">listFileContent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> routerFileFrom = <span class="string">&#x27;./.template/examples/router.ts.tpl&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> routerFileTo = <span class="string">&#x27;../../examples/router.ts&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> routerFileTpl = fs.readFileSync(resolve(__dirname, routerFileFrom), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> routerMeta = &#123;</span><br><span class="line">    routes: listFileContent.map(<span class="function"><span class="params">comp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&#123;</span></span><br><span class="line"><span class="string">        title: &#x27;<span class="subst">$&#123;comp.compCnName&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">        name: &#x27;<span class="subst">$&#123;comp.compName&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">        path: &#x27;/components/<span class="subst">$&#123;comp.compName&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">        component: () =&gt; import(&#x27;../packages/<span class="subst">$&#123;comp.compName&#125;</span>/docs/README.md&#x27;),</span></span><br><span class="line"><span class="string">      &#125;`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> routerFileContent = handlebars.compile(routerFileTpl, &#123; <span class="attr">noEscape</span>: <span class="literal">true</span> &#125;)(routerMeta)</span><br><span class="line">  fs.outputFile(resolve(__dirname, routerFileTo), routerFileContent, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新 index.ts</span></span><br><span class="line"><span class="keyword">const</span> installTsTplReplacer = <span class="function">(<span class="params">listFileContent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> installFileFrom = <span class="string">&#x27;./.template/packages/index.ts.tpl&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> installFileTo = <span class="string">&#x27;../../packages/index.ts&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> installFileTpl = fs.readFileSync(resolve(__dirname, installFileFrom), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> installMeta = &#123;</span><br><span class="line">    importPlugins: listFileContent.map(<span class="function">(<span class="params">&#123; compName &#125;</span>) =&gt;</span> <span class="string">`import &#123; Ku<span class="subst">$&#123;compName&#125;</span>Plugin &#125; from &#x27;./<span class="subst">$&#123;compName&#125;</span>&#x27;;`</span>).join(<span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">    installPlugins: listFileContent.map(<span class="function">(<span class="params">&#123; compName &#125;</span>) =&gt;</span> <span class="string">`Ku<span class="subst">$&#123;compName&#125;</span>Plugin.install?.(app);`</span>).join(<span class="string">&#x27;\n    &#x27;</span>),</span><br><span class="line">    exportPlugins: listFileContent.map(<span class="function">(<span class="params">&#123; compName &#125;</span>) =&gt;</span> <span class="string">`export * from &#x27;./<span class="subst">$&#123;compName&#125;</span>&#x27;`</span>).join(<span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> installFileContent = handlebars.compile(installFileTpl, &#123; <span class="attr">noEscape</span>: <span class="literal">true</span> &#125;)(installMeta)</span><br><span class="line">  fs.outputFile(resolve(__dirname, installFileTo), installFileContent, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (meta) =&gt; &#123;</span><br><span class="line">  compFilesTplReplacer(meta)</span><br><span class="line">  <span class="keyword">const</span> listFileContent = listJsonTplReplacer(meta)</span><br><span class="line">  routerTplReplacer(listFileContent)</span><br><span class="line">  installTsTplReplacer(listFileContent)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`组件新建完毕，请前往 packages/<span class="subst">$&#123;meta.compName&#125;</span> 目录进行开发`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码中的 listFileContent 即为 /packages/list.json 中的内容，这个 JSON 文件也是需要根据新组件而动态更新。<br>在完成了模板替换的相关逻辑后，就可以把它们都收归到一个可执行文件中(script/generater/index.mjs)：</p>
<figure class="highlight mjs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> infoCollector <span class="keyword">from</span> <span class="string">&#x27;./infoCollector.mjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> tplReplacer <span class="keyword">from</span> <span class="string">&#x27;./tplReplacer.mjs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> meta = <span class="keyword">await</span> infoCollector()</span><br><span class="line">  tplReplacer(meta)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run()</span><br></pre></td></tr></table></figure>
<p>新增一个 npm script 到 package.json：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;gen&quot;</span>: <span class="string">&quot;node --experimental-modules ./script/generater/index.mjs&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>安装相应依赖<br><code>yarn add fs-extra inquirer handlebars -D</code><br>接下来只要执行 yarn gen 就可以进入交互式终端，回答问题自动完成新建组件文件、修改配置的功能，并能够在可交互式文档中实时预览效果。</p>
<h3 id="六、添加主题文件"><a href="#六、添加主题文件" class="headerlink" title="六、添加主题文件"></a>六、添加主题文件</h3><p>新建exeamples/theme/index.less文件</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#colors</span>() &#123;</span><br><span class="line">  <span class="selector-class">.dust-red</span>() &#123;</span><br><span class="line">    <span class="comment">// Dust Red / 薄暮</span></span><br><span class="line">    <span class="comment">// 斗志、奔放</span></span><br><span class="line">    red-1: #fff1f0;</span><br><span class="line">    red-2: #ffccc7;</span><br><span class="line">    red-3: #ffa39e;</span><br><span class="line">    red-4: #ff7875;</span><br><span class="line">    red-5: #ff4d4f;</span><br><span class="line">    red-6: #f5222d;</span><br><span class="line">    red-7: #cf1322;</span><br><span class="line">    red-8: #a8071a;</span><br><span class="line">    red-9: #820014;</span><br><span class="line">    red-10: #5c0011;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.lime</span>() &#123;</span><br><span class="line">    <span class="comment">// Lime / 青柠</span></span><br><span class="line">    <span class="comment">// 自然、生机</span></span><br><span class="line">    lime-1: #fcffe6;</span><br><span class="line">    lime-2: #f4ffb8;</span><br><span class="line">    lime-3: #eaff8f;</span><br><span class="line">    lime-4: #d3f261;</span><br><span class="line">    lime-5: #bae637;</span><br><span class="line">    lime-6: #a0d911;</span><br><span class="line">    lime-7: #7cb305;</span><br><span class="line">    lime-8: #5b8c00;</span><br><span class="line">    lime-9: #3f6600;</span><br><span class="line">    lime-10: #254000;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.daybreak-blue</span>() &#123;</span><br><span class="line">    <span class="comment">// Daybreak Blue / 拂晓蓝</span></span><br><span class="line">    <span class="comment">// 包容、科技、普惠</span></span><br><span class="line">    blue-1: #e6f7ff;</span><br><span class="line">    blue-2: #bae7ff;</span><br><span class="line">    blue-3: #91d5ff;</span><br><span class="line">    blue-4: #69c0ff;</span><br><span class="line">    blue-5: #40a9ff;</span><br><span class="line">    blue-6: #1890ff;</span><br><span class="line">    blue-7: #096dd9;</span><br><span class="line">    blue-8: #0050b3;</span><br><span class="line">    blue-9: #003a8c;</span><br><span class="line">    blue-10: #002766;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------- Colors -----------</span></span><br><span class="line"><span class="variable">@primary-color:</span> #colors.lime[lime-<span class="number">6</span>];</span><br></pre></td></tr></table></figure>

<p>在App.module.less等中引用，并使用主题色</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&quot;./theme/index.less&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.App</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.aside</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20%</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.item</span> &#123;</span><br><span class="line">      <span class="selector-tag">&amp;</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">        <span class="selector-tag">a</span> &#123;</span><br><span class="line">          <span class="attribute">color</span>: <span class="variable">@primary-color</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.main</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">h1</span> &#123;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">      <span class="attribute">font-weight</span>: bold;</span><br><span class="line">      <span class="attribute">margin-bottom</span>: <span class="number">16px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理，在packages下也要新建一个主题文件，并将组件移动components目录下</p>
<h3 id="七、库模式"><a href="#七、库模式" class="headerlink" title="七、库模式"></a>七、库模式</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  build: &#123;</span><br><span class="line">    lib: &#123;</span><br><span class="line">      <span class="comment">// Could also be a dictionary or array of multiple entry points</span></span><br><span class="line">      entry: resolve(__dirname, <span class="string">&#x27;lib/main.js&#x27;</span>),</span><br><span class="line">      name: <span class="string">&#x27;MyLib&#x27;</span>,</span><br><span class="line">      <span class="comment">// the proper extensions will be added</span></span><br><span class="line">      fileName: <span class="string">&#x27;my-lib&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      <span class="comment">// 确保外部化处理那些你不想打包进库的依赖</span></span><br><span class="line">      external: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      output: &#123;</span><br><span class="line">        <span class="comment">// 在 UMD 构建模式下为这些外部化的依赖提供一个全局变量</span></span><br><span class="line">        globals: &#123;</span><br><span class="line">          vue: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// lib/main.js</span></span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">&#x27;./Bar.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; Foo, Bar &#125;</span><br></pre></td></tr></table></figure>

<p>推荐在你库的 package.json 中使用如下格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;my-lib&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [<span class="string">&quot;dist&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;./dist/my-lib.umd.cjs&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;./dist/my-lib.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;exports&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;.&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;import&quot;</span>: <span class="string">&quot;./dist/my-lib.js&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;require&quot;</span>: <span class="string">&quot;./dist/my-lib.umd.cjs&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="八、分开文档和库的构建逻辑"><a href="#八、分开文档和库的构建逻辑" class="headerlink" title="八、分开文档和库的构建逻辑"></a>八、分开文档和库的构建逻辑</h3><p>在默认的 Vite 配置中，执行 yarn build 所构建出来的产物是“可交互式文档网站”，并非“组件库”本身。为了构建一个 kudzu-ui 组件库并发布到 npm，我们需要将构建的逻辑分开。<br>在script根目录下添加一个 build 目录，依次写入 base.ts，lib.ts 和 doc.ts，分别为基础配置、库配置和文档配置。</p>
<p>base.ts<br>基础配置，需要确定路径别名、配置 Vue 插件和 Markdown 插件用于对应文件的解析。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pxtoviewport <span class="keyword">from</span> <span class="string">&#x27;postcss-px-to-viewport&#x27;</span> <span class="comment">// 自适应vh、vw</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Markdown <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-md&#x27;</span> <span class="comment">// markdown解析</span></span><br><span class="line"><span class="keyword">import</span> VueMacros <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-macros/vite&#x27;</span> <span class="comment">// vue 宏定义defineOptions等</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pxtoviewportConfig = pxtoviewport(&#123;</span><br><span class="line">  viewportWidth: <span class="number">1366</span>, <span class="comment">// 设计稿的视口宽度</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    VueMacros(&#123;</span><br><span class="line">      plugins: &#123;</span><br><span class="line">        vue: vue(&#123; <span class="attr">include</span>: [<span class="regexp">/\.vue$/</span>, <span class="regexp">/\.md$/</span>] &#125;),</span><br><span class="line">        vueJsx: vueJsx(&#123;</span><br><span class="line">          <span class="comment">// options are passed on to @vue/babel-plugin-jsx</span></span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    Markdown(),</span><br><span class="line">  ],</span><br><span class="line">  css: &#123;</span><br><span class="line">    postcss: &#123;</span><br><span class="line">      plugins: [pxtoviewportConfig]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&#x27;@kudzu&#x27;</span>: path.resolve(__dirname, <span class="string">&#x27;../../packages&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;@examples&#x27;</span>: path.resolve(__dirname, <span class="string">&#x27;../../examples&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<p>lib.ts<br>库构建，用于构建位于 /packages 目录的组件库，同时需要 vite-plugin-dts 来帮助把一些 TS 声明文件给打包出来。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">&#x27;./base&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> dts <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-dts&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  ...base,</span><br><span class="line">  build: &#123;</span><br><span class="line">    outDir: <span class="string">&#x27;lib&#x27;</span>,</span><br><span class="line">    lib: &#123;</span><br><span class="line">      <span class="comment">// Could also be a dictionary or array of multiple entry points</span></span><br><span class="line">      entry: path.resolve(__dirname, <span class="string">&#x27;../../packages/index.ts&#x27;</span>),</span><br><span class="line">      name: <span class="string">&#x27;KudzuUI&#x27;</span>,</span><br><span class="line">      <span class="comment">// the proper extensions will be added</span></span><br><span class="line">      fileName: <span class="string">&#x27;kudzu-ui&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      <span class="comment">// 确保外部化处理那些你不想打包进库的依赖</span></span><br><span class="line">      external: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      output: &#123;</span><br><span class="line">        <span class="comment">// 在 UMD 构建模式下为这些外部化的依赖提供一个全局变量</span></span><br><span class="line">        globals: &#123;</span><br><span class="line">          vue: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    ...base.plugins,</span><br><span class="line">    dts(),</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>doc.ts<br>交互式文档构建配置，跟 base 是几乎一样的，只需要修改输出目录为 docs 即可。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">&#x27;./base&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  ...base,</span><br><span class="line">  build: &#123;</span><br><span class="line">    outDir: <span class="string">&#x27;docs&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>构建文档时需要把 /packages 目录也一并复制到输出目录，拷贝目录代码如下：</p>
<figure class="highlight mjs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该模块在window下运行会有问题，windows系统建议使用git base运行build:doc命令</span></span><br><span class="line"><span class="keyword">import</span> &#123; spawn &#125; <span class="keyword">from</span> <span class="string">&#x27;child_process&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copy = <span class="function">(<span class="params">src, dist</span>) =&gt;</span> &#123;</span><br><span class="line">  spawn(<span class="string">&#x27;cp&#x27;</span>, [<span class="string">&#x27;-r&#x27;</span>, , src, dist])</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">copy(<span class="string">&#x27;./packages&#x27;</span>, <span class="string">&#x27;./docs&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>完成了上面这些构建配置以后，修改一下 npm script 即可：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;vite --config ./script/build/base.ts&quot;,</span><br><span class="line">&quot;build:lib&quot;: &quot;vue-tsc --noEmit &amp;&amp; vite build --config ./script/build/lib.ts&quot;,</span><br><span class="line">&quot;build:doc&quot;: &quot;vue-tsc --noEmit &amp;&amp; vite build --config ./script/build/doc.ts &amp;&amp; node --experimental-modules ./script/build/copy.mjs&quot;,</span><br></pre></td></tr></table></figure>

<p>build:lib 的产物：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">lib</span><br><span class="line">│  kudzu-ui.js</span><br><span class="line">│  kudzu-ui.umd.cjs</span><br><span class="line">│  style.css</span><br><span class="line">│  tree.md</span><br><span class="line">│  vite.svg</span><br><span class="line">│  </span><br><span class="line">├─examples</span><br><span class="line">│      vite-env.d.ts</span><br><span class="line">│      </span><br><span class="line">└─packages</span><br><span class="line">    │  index.d.ts</span><br><span class="line">    │  </span><br><span class="line">    ├─components</span><br><span class="line">    │  ├─Button</span><br><span class="line">    │  │  │  index.d.ts</span><br><span class="line">    │  │  │  </span><br><span class="line">    │  │  └─src</span><br><span class="line">    │  │          index.d.ts</span><br><span class="line">    │  │          </span><br><span class="line">    │  └─Tag</span><br><span class="line">    │      │  index.d.ts</span><br><span class="line">    │      │  </span><br><span class="line">    │      └─src</span><br><span class="line">    │              index.d.ts</span><br><span class="line">    │              </span><br><span class="line">    └─utils</span><br><span class="line">            index.d.ts</span><br><span class="line">            install.d.ts</span><br><span class="line">            typescript.d.ts</span><br></pre></td></tr></table></figure>
<p>build:doc 的产物：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docs</span><br><span class="line">├── assets</span><br><span class="line">│   ├── README.04f9b87a.js</span><br><span class="line">│   ├── README.e8face78.js</span><br><span class="line">│   ├── index.917a75eb.js</span><br><span class="line">│   ├── index.f005ac77.css</span><br><span class="line">│   └── vendor.234e3e3c.js</span><br><span class="line">├── index.html</span><br><span class="line">└── packages</span><br></pre></td></tr></table></figure>

<p>大功告成！</p>
<h3 id="九、打包"><a href="#九、打包" class="headerlink" title="九、打包"></a>九、打包</h3><p>打包入口和文件配置main为打包后入口文件，files为publish时上传到npm的文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;kudzu-ui&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.0.9&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;./lib/kudzu-ui.umd.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;./lib/kudzu-ui.es.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;fenpho&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/fenpho/kudzu-ui&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;lib&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dev&quot;</span>: <span class="string">&quot;vite --config ./script/build/base.ts&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build:lib&quot;</span>: <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build --config ./script/build/lib.ts&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build:doc&quot;</span>: <span class="string">&quot;vue-tsc --noEmit &amp;&amp; vite build --config ./script/build/doc.ts &amp;&amp; node --experimental-modules ./script/build/copy.mjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;gen&quot;</span>: <span class="string">&quot;node --experimental-modules ./script/generater/index.mjs&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;vue&quot;</span>: <span class="string">&quot;^3.2.41&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@rollup/pluginutils&quot;</span>: <span class="string">&quot;^5.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@vitejs/plugin-vue&quot;</span>: <span class="string">&quot;^3.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@vitejs/plugin-vue-jsx&quot;</span>: <span class="string">&quot;^2.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fs-extra&quot;</span>: <span class="string">&quot;^11.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;handlebars&quot;</span>: <span class="string">&quot;^4.7.7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;inquirer&quot;</span>: <span class="string">&quot;8.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;less&quot;</span>: <span class="string">&quot;^4.1.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;postcss-px-to-viewport&quot;</span>: <span class="string">&quot;^1.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;prismjs&quot;</span>: <span class="string">&quot;^1.29.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span>: <span class="string">&quot;^4.6.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;unplugin-vue-macros&quot;</span>: <span class="string">&quot;^1.0.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vite&quot;</span>: <span class="string">&quot;^3.2.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vite-plugin-dts&quot;</span>: <span class="string">&quot;^1.7.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vite-plugin-md&quot;</span>: <span class="string">&quot;^0.20.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-router&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-tsc&quot;</span>: <span class="string">&quot;^1.0.9&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>依赖不需要打包的需要在vite的配置文件里面列出或者放入devDependencies里面，vue已经在打包配置了排除，故依旧放正dependencies里</p>
<p>如果是小白，没有发布过npm包，可以参考我的这篇博文<br><a href="https://fenpho.github.io/2022/09/15/npm%E5%8F%91%E5%8C%85%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/">npm发包详细教程</a></p>
<p>使用<br><code>npm i kudzu-ui</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> KudzuUI <span class="keyword">from</span> <span class="string">&#x27;kudzu-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;kudzu-ui/lib/style.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line"></span><br><span class="line">app.use(KudzuUI);</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>至此我们的组件开发框架已经基本完成了，它具备了相对完整的代码开发、实时交互式文档、命令式新建组件等能力，开发组件已经拥有了不错的体验。当然它距离完美还有很长的距离，比如说单元测试、还没集成进去，组件库的版本管理和 CHANGELOG 还需要接入，这些不完美的部分都很值得补充进去。本文纯当抛砖引玉，也期待更多的交流~</p>
<p>最后，附上项目源码：<a target="_blank" rel="noopener" href="https://github.com/fenpho/kudzu-ui">GitHub项目仓库 </a><br>项目预览：<a href="https://fenpho.github.io/kudzu-ui/get-start">点击我</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    
    <a class="pull-right" href="/2022/09/15/npm%E5%8F%91%E5%8C%85%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/">
        npm发包详细教程 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2017<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Fenpho. All Rights Reserved.
                </p>
                <p>Theme By <a href="#" style="color: #767D84">Fenpho</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/fenpho" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
